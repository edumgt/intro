<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시판</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css">
    <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <style>
        body.dark-mode {
            background-color: #121212;
            color: #ffffff;
        }
        .dark-mode .tui-grid-header-area, .dark-mode .tui-grid-body-area {
            background-color: #2e2e2e;
            color: #ffffff;
        }
        .dark-mode .tui-grid-cell {
            background-color: #3e3e3e;
            color: #ffffff;
        }
        .dark-mode .modal-content {
            background-color: #2e2e2e;
            color: #ffffff;
        }
        .new-icon {
            color: red;
            font-weight: bold;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row mb-3">
            <div class="col-auto">
                <input type="text" id="searchInput" class="form-control" placeholder="검색어 입력" style="width: 300px;">
            </div>
            <div class="col-auto">
                <button id="searchButton" class="btn btn-primary">검색</button>
                <button id="addRow" class="btn btn-success ms-2">추가</button>
                <button id="removeRow" class="btn btn-danger ms-2">삭제</button>
				
                
            </div>
            <div class="col-auto align-self-center">
                <span id="dataCount" class="ms-3"></span>
            </div>
        </div>
        <div id="grid"></div>
    </div>

    <!-- Add Row Modal -->
    <div class="modal fade" id="addRowModal" tabindex="-1" aria-labelledby="addRowModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRowModalLabel">새 항목 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addRowForm">
                        <div class="mb-3">
                            <label for="titleInput" class="form-label">제목</label>
                            <input type="text" class="form-control" id="titleInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="contentInput" class="form-label">내용</label>
                            <textarea class="form-control" id="contentInput" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="authorInput" class="form-label">작성자</label>
                            <input type="text" class="form-control" id="authorInput" required>
                        </div>
                        <button type="submit" class="btn btn-primary">추가</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">삭제 확인</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    선택한 항목을 삭제하시겠습니까?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">삭제</button>
                </div>
            </div>
        </div>
    </div>

    <script>

//document.addEventListener('DOMContentLoaded', function() {
    // UUID 생성 함수
    function generateUUID() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    // 현재 날짜를 YYYY-MM-DD 형식으로 반환하는 함수
    function getCurrentDate() {
        const date = new Date();
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // 로컬 스토리지에서 데이터 불러오기
    const storedData = JSON.parse(localStorage.getItem('gridDataSample2'));

    const grid = new tui.Grid({
        el: document.getElementById('grid'),
        data: storedData,
        columns: [
            { header: 'ID', name: 'id', width: 100, sortable: true, resizable: true },
            { header: '제목', name: 'title', editor: 'text', sortable: true, resizable: true },
            { header: '내용', name: 'content', editor: 'text', sortable: true, resizable: true },
            { header: '작성자', name: 'author', editor: 'text', sortable: true, resizable: true },
            { header: '날짜', name: 'date', editor: 'text', sortable: true, resizable: true }
        ],
        rowHeaders: ['checkbox'],
        columnOptions: {
            resizable: true
        }
    });

    // 데이터 총 건수 업데이트 함수
    function updateDataCount() {
        const dataCount = grid.getData().length;
        document.getElementById('dataCount').textContent = `총 건수: ${dataCount}`;
    }

    // 데이터 저장 함수
    function saveData() {
        const data = grid.getData();
        localStorage.setItem('gridDataSample2', JSON.stringify(data));
        updateDataCount();
    }

    // 초기 데이터 총 건수 업데이트
    updateDataCount();

    // 행 추가 기능
    document.getElementById('addRow').addEventListener('click', function() {
        console.log('추가 버튼 클릭됨');
        const addRowModal = new bootstrap.Modal(document.getElementById('addRowModal'));
        addRowModal.show();
    });

    // 모달 폼 제출 시 새로운 행 추가
    document.getElementById('addRowForm').addEventListener('submit', function(event) {
        event.preventDefault();
        console.log('새 항목 추가 폼 제출됨');
        const title = document.getElementById('titleInput').value;
        const content = document.getElementById('contentInput').value;
        const author = document.getElementById('authorInput').value;
        const newRow = { id: generateUUID(), title: title, content: content, author: author, date: getCurrentDate(), isNew: true };
        grid.appendRow(newRow);  // 새 행을 추가
        saveData();
		const addRowModal = bootstrap.Modal.getInstance(document.getElementById('addRowModal'));
        addRowModal.hide();
        document.getElementById('addRowForm').reset();
    });

    // 삭제할 행을 저장할 변수
    let rowsToDelete = [];

    // 삭제 버튼 클릭 시 모달 팝업 표시
    document.getElementById('removeRow').addEventListener('click', function() {
        console.log('삭제 버튼 클릭됨');
        rowsToDelete = grid.getCheckedRows();
        if (rowsToDelete.length > 0) {
            const confirmDeleteModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            confirmDeleteModal.show();
        } else {
            alert('삭제할 항목을 선택하세요.');
        }
    });

    // 모달 팝업에서 삭제 확인 버튼 클릭 시 행 삭제
    document.getElementById('confirmDeleteButton').addEventListener('click', function() {
        console.log('삭제 확인 버튼 클릭됨');
        rowsToDelete.forEach(row => {
            grid.removeRow(row.rowKey);
        });
        saveData();
        rowsToDelete = [];
        const confirmDeleteModal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
        confirmDeleteModal.hide();
    });

    // 데이터 변경 시 로컬 스토리지에 저장
    grid.on('afterChange', function() {
        console.log('데이터 변경됨');
        saveData();
		grid.refreshLayout();
    });

    // 검색 기능
    document.getElementById('searchButton').addEventListener('click', function() {
        console.log('검색 버튼 클릭됨');
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        if (searchValue) {
            const filteredData = storedData.filter(item => 
                item.title.toLowerCase().includes(searchValue) ||
                item.content.toLowerCase().includes(searchValue) ||
                item.author.toLowerCase().includes(searchValue) ||
                item.date.toLowerCase().includes(searchValue)
            );
            grid.resetData(filteredData);
        } else {
            location.reload();  // 검색어가 없으면 페이지를 새로고침
        }
        updateDataCount();
    });

	

//});



    </script>
</body>
</html>
