<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시판</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.grid/latest/tui-grid.css">
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css">
    <script src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"></script>
    <script src="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.js"></script>
    <script src="https://uicdn.toast.com/tui.grid/latest/tui-grid.js"></script>
    <style>
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
            pointer-events: auto;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            pointer-events: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Grid container with Y-Scroll */
        #grid {
            height: calc(100vh - 200px); /* Adjust height to fill the screen */
            overflow-y: auto;
        }

        /* Pagination styles */
        .tui-pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .tui-pagination .tui-page-btn {
            margin: 0 5px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }

        .tui-pagination .tui-page-btn.tui-is-selected {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <div class="flex justify-between items-center mb-4">
            <div class="flex space-x-2">
                <input type="text" id="searchInput" class="form-input w-64" placeholder="검색어 입력">
                <button id="searchButton" class="bg-blue-500 text-white px-4 py-2 rounded">검색</button>
                <button id="addRow" class="bg-green-500 text-white px-4 py-2 rounded">추가</button>
                <button id="removeRow" class="bg-red-500 text-white px-4 py-2 rounded">삭제</button>
                <!-- button id="saveButton" class="bg-yellow-500 text-white px-4 py-2 rounded">저장</button -->
            </div>
            <div>
                <span id="dataCount" class="text-gray-700"></span>
            </div>
        </div>
        <div id="grid" class="mb-4"></div>
        <div id="pagination" class="tui-pagination"></div>
    </div>

    <!-- Add Row Modal -->
    <div id="addRowModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl mb-4">새 항목 추가</h2>
            <form id="addRowForm" class="space-y-4">
                <div>
                    <label for="titleInput" class="block text-sm font-medium text-gray-700">제목</label>
                    <input type="text" id="titleInput" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required>
                </div>
                <div>
                    <label for="contentInput" class="block text-sm font-medium text-gray-700">내용</label>
                    <textarea id="contentInput" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" rows="3" required></textarea>
                </div>
                <div>
                    <label for="authorInput" class="block text-sm font-medium text-gray-700">작성자</label>
                    <input type="text" id="authorInput" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required>
                </div>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">추가</button>
            </form>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl mb-4">삭제 확인</h2>
            <p>선택한 항목을 삭제하시겠습니까?</p>
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded" id="cancelDeleteButton">취소</button>
                <button type="button" class="bg-red-500 text-white px-4 py-2 rounded" id="confirmDeleteButton">삭제</button>
            </div>
        </div>
    </div>

    <!-- Save Confirmation Modal -->
    <div id="saveConfirmationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl mb-4">저장 완료</h2>
            <p>데이터가 저장되었습니다.</p>
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded" id="closeSaveConfirmationButton">확인</button>
            </div>
        </div>
    </div>

    <script>
        // UUID 생성 함수
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // 현재 날짜를 YYYY-MM-DD 형식으로 반환하는 함수
        function getCurrentDate() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 로컬 스토리지에서 데이터 불러오기
        const storedData = JSON.parse(localStorage.getItem('grid2')) || [];

        const grid = new tui.Grid({
            el: document.getElementById('grid'),
            data: storedData.slice(0, 5), // 초기 데이터 설정
            columns: [
                { header: 'ID', name: 'id', width: 100, sortable: true, resizable: true },
                { header: '제목', name: 'title', editor: 'text', sortable: true, resizable: true },
                { header: '내용', name: 'content', editor: 'text', sortable: true, resizable: true },
                { header: '작성자', name: 'author', editor: 'text', sortable: true, resizable: true },
                { header: '날짜', name: 'date', editor: 'text', sortable: true, resizable: true }
            ],
            rowHeaders: ['checkbox'],
            columnOptions: {
                resizable: true
            }
        });

        const pagination = new tui.Pagination(document.getElementById('pagination'), {
            totalItems: storedData.length,
            itemsPerPage: 5,
            visiblePages: 5,
            centerAlign: true
        });

        pagination.on('beforeMove', (event) => {
            const currentPage = event.page;
            const start = (currentPage - 1) * 5;
            const end = start + 5;
            grid.resetData(storedData.slice(start, end));
        });

        // 데이터 총 건수 업데이트 함수
        function updateDataCount() {
            const dataCount = storedData.length;
            document.getElementById('dataCount').textContent = `총 건수: ${dataCount}`;
        }

        // 데이터 저장 함수
        function saveData() {
            const data = grid.getData();
            localStorage.setItem('grid2', JSON.stringify(data));
            updateDataCount();
        }

        // 초기 데이터 총 건수 업데이트
        updateDataCount();

        document.getElementById('addRow').addEventListener('click', function() {
            document.getElementById('addRowModal').style.display = 'block';
        });

        // 모달 폼 제출 시 새로운 행 추가
        document.getElementById('addRowForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const title = document.getElementById('titleInput').value;
            const content = document.getElementById('contentInput').value;
            const author = document.getElementById('authorInput').value;
            const newRow = { id: generateUUID(), title: title, content: content, author: author, date: getCurrentDate(), isNew: true };
            grid.appendRow(newRow);  // 새 행을 추가
            saveData();
            document.getElementById('addRowModal').style.display = 'none';
            document.getElementById('addRowForm').reset();
        });

        // 삭제할 행을 저장할 변수
        let rowsToDelete = [];

        // 삭제 버튼 클릭 시 모달 팝업 표시
        document.getElementById('removeRow').addEventListener('click', function() {
            rowsToDelete = grid.getCheckedRows();
            if (rowsToDelete.length > 0) {
                document.getElementById('confirmDeleteModal').style.display = 'block';
            } else {
                alert('삭제할 항목을 선택하세요.');
            }
        });

        // 모달 팝업에서 삭제 확인 버튼 클릭 시 행 삭제
        document.getElementById('confirmDeleteButton').addEventListener('click', function() {
            rowsToDelete.forEach(row => {
                grid.removeRow(row.rowKey);
            });
            saveData();
            rowsToDelete = [];
            document.getElementById('confirmDeleteModal').style.display = 'none';
        });

        // 변경된 행만 저장하는 함수
        function saveChangedRows(changes) {
            changes.forEach(change => {
                const rowKey = change.rowKey;
                const updatedRow = grid.getRow(rowKey);
                const index = storedData.findIndex(item => item.id === updatedRow.id);
                if (index !== -1) {
                    storedData[index] = updatedRow;
                }
            });
            localStorage.setItem('grid2', JSON.stringify(storedData));
        }

        // 데이터 변경 시 변경된 행만 저장
        grid.on('afterChange', function(ev) {
            saveChangedRows(ev.changes);
        });

        // 검색 기능
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            if (searchValue) {
                const filteredData = storedData.filter(item => 
                    item.title.toLowerCase().includes(searchValue) ||
                    item.content.toLowerCase().includes(searchValue) ||
                    item.author.toLowerCase().includes(searchValue) ||
                    item.date.toLowerCase().includes(searchValue)
                );
                grid.resetData(filteredData);
            } else {
                grid.resetData(storedData.slice(0, 5));
                pagination.reset(storedData.length);
            }
            updateDataCount();
        });

        // 모달 닫기 버튼 클릭 시 모달 닫기
        document.querySelectorAll('.close').forEach(element => {
            element.addEventListener('click', () => {
                element.closest('.modal').style.display = 'none';
            });
        });

        // 모달 외부 클릭 시 모달 닫기
        window.addEventListener('click', event => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        // 저장 버튼 클릭 시 데이터 저장
        // document.getElementById('saveButton').addEventListener('click', function() {
        //     saveData();
        //     document.getElementById('saveConfirmationModal').style.display = 'block';
        // });

        // 저장 확인 모달 닫기 버튼 클릭 시 모달 닫기
        document.getElementById('closeSaveConfirmationButton').addEventListener('click', function() {
            document.getElementById('saveConfirmationModal').style.display = 'none';
        });
    </script>
</body>
</html>
