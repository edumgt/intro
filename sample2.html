<!DOCTYPE html>
<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css" />
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />


    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">


    <script type="text/javascript" src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"></script>
    <script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.js"></script>
    <script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>

    <style>
        .tui-grid-header-area {
            background-color: #98b2e6 !important;
            color: #f5f6f8 !important;
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui,
                Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic",
                "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif !important;
        }

        .tui-grid-cell {
            background-color: transparent !important;
            font-size: 16px !important;

            color: #333 !important;
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui,
                Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic",
                "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif !important;

        }

        /* Remove default yellow/pink backgrounds in TUI Grid */
        .tui-grid-cell.tui-grid-cell-has-focus {
            background-color: transparent !important;
            border-color: #3182ce !important;
        }

        .tui-grid-cell.tui-grid-cell-invalid {
            background-color: transparent !important;
        }


        .tui-grid-cell.tui-grid-cell-has-focus .tui-grid-cell-content {
            color: #bf4005 !important;

        }
    </style>


    <style>
        .toast {
            position: fixed;
            top: 1rem;
            /* Move to the top of the screen */
            right: 1rem;
            /* Align to the right */
            min-width: 200px;
            padding: 1rem;
            border-radius: 5px;
            font-size: 14px;
            color: #fff;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            /* Adjust animation direction for top placement */
            transition: opacity 0.3s, transform 0.3s;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-success {
            background-color: #38a169;
        }

        .toast-warning {
            background-color: #dd6b20;
        }

        .toast-info {
            background-color: #3182ce;
        }

        .toast-error {
            background-color: #e53e3e;
        }
    </style>




</head>

<body class="bg-gray-100">
    <!-- Toast Container -->
    <div id="toast-container"></div>



    <!-- content -->
    <div id="content" class="container mx-auto p-6">


        <div class="bg-white shadow rounded-lg p-6">

            <div class="flex justify-between items-center mb-2">
                <h2 class="text-lg font-semibold">에듀엠지티 기본 Grid Sample</h2>
            </div>

            <div class="border-gray-200 rounded-lg">
                <!-- Data count positioned above the grid on the left -->
                <div class="flex justify-between items-center p-4">
                    <div id="dataCount" class="text-sm text-gray-700"></div>
                    <div class="flex justify-end mt-4 space-x-2">
                        <button id="newrow"
                            class="px-4 py-1.5 text-white font-medium rounded bg-gray-800 hover:bg-gray-700">
                            신규
                        </button>
                        <button id="delrow"
                            class="px-4 py-1.5 text-white font-medium rounded bg-gray-800 hover:bg-gray-700">
                            삭제
                        </button>
                        <button id="saverow"
                            class="px-4 py-1.5 text-white font-medium rounded bg-gray-800 hover:bg-gray-700">
                            저장
                        </button>
                    </div>

                </div>
                <!-- The grid -->
                <div id="grid" style="height: 580px;"></div>
            </div>




        </div>
    </div>

    <!-- Modal Popup -->
    <div id="modal"
        class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-6 w-1/3">
            <h2 class="text-lg font-semibold mb-4">Modal Popup</h2>
            <p id="modalContent">You clicked on the View icon.</p>
            <button id="closeModal"
                class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700 mt-4">Close</button>
        </div>
    </div>

    <!-- //content -->

    <script>

function toggleModal(show, content = '') {
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modalContent');
    if (show) {
        modalContent.textContent = content; // Update content dynamically
        modal.classList.remove('hidden');
    } else {
        modal.classList.add('hidden');
    }
}
        // Toast Functionality
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} show`;
            toast.innerText = message;

            toastContainer.appendChild(toast);

            // Automatically remove the toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', function () {

            // UUID Generator Function
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    const r = (Math.random() * 16) | 0,
                        v = c === 'x' ? r : (r & 0x3) | 0x8;
                    return v.toString(16);
                });
            }

            let rowsPerPage = 10; // Default rows per page

            // Function to update pagination
            function updatePagination(totalItems, perPage) {
                pagination.reset(totalItems); // Reset pagination with the updated total items
                pagination.setItemsPerPage(perPage); // Set items per page
            }

            // Function to load paginated data
            function loadPageData(page, perPage) {
                const allData = loadData();
                const start = (page - 1) * perPage;
                const end = start + perPage;
                return allData.slice(start, end);
            }

            // Function to update the total count display
            function updateDataCount() {
                const allData = loadData();
                const dataCountElement = document.getElementById('dataCount');
                dataCountElement.textContent = `Total Rows: ${allData.length}`;
            }

            // Function to load data from localStorage
            function loadData() {
                const data = localStorage.getItem('gridData');
                return data ? JSON.parse(data) : [];
            }

            // Function to save data to localStorage
            function saveData(data) {
                const filteredData = data.filter(row => row.tpCd && row.tpNm);
                localStorage.setItem('gridData', JSON.stringify(filteredData));
            }

            // Initialize the grid
            const grid = new tui.Grid({
                el: document.getElementById('grid'),
                rowHeaders: ['checkbox', 'rowNum'],
                editingEvent: 'click',
                scrollX: true,
                scrollY: true,
                pageOptions: {
                    useClient: true,
                    perPage: rowsPerPage
                },
                rowHeight: 43,
                minRowHeight: 43,
                columns: [
                    { header: 'Key', name: 'Key', width: 250, align: 'left', sortable: true, resizable: true, width: 100, minWidth: 80 }, // UUID column    
                    { header: '그룹코드', name: 'tpCd', editor: 'text', validation: { required: true }, sortable: true, filter: 'text', resizable: true, width: 150 },
                    { header: '코드명', name: 'tpNm', editor: 'text', sortable: true, filter: 'text', resizable: true, width: 200 },
                    { header: '설명', name: 'descCntn', editor: 'text', sortable: true, filter: 'text', resizable: true, },
                    {
                        header: '사용여부', name: 'useYn', width: 100, align: 'center',
                        editor: {
                            type: 'select',
                            options: { listItems: [{ text: 'Y', value: 'Y' }, { text: 'N', value: 'N' }] }
                        },
                        sortable: true,
                        filter: {
                            type: 'select',
                            options: [
                                { text: 'All', value: '' },
                                { text: 'Y', value: 'Y' },
                                { text: 'N', value: 'N' }
                            ]
                        }
                    },
                    {
                        header: 'View',
                        name: 'view',
                        align: 'center',
                        text: 'V',
                        width: 60,
                        resizable: false
                    }
                ],
                data: loadPageData(1, rowsPerPage), // Load initial page data
                columnOptions: {
                    frozenCount: 2, // Freeze 3 left most columns and 
                    frozenBorderWidth: 2 // set the border width of frozen columns to be 2px.
                }
            });



            // Apply TUI Grid theme
            tui.Grid.applyTheme('default');

            // Initial update of data count
            updateDataCount();

            // Delete row functionality
            document.getElementById('delrow').addEventListener('click', function () {
                const chkArray = grid.getCheckedRowKeys();
                if (chkArray.length > 0) {
                    grid.removeCheckedRows();
                    saveData(grid.getData());
                    showToast('선택된 항목이 삭제되었습니다.', 'success');
                    updateDataCount();
                    //updatePagination(loadData().length, rowsPerPage);
                } else {
                    showToast('삭제할 항목이 선택되지 않았습니다.', 'warning');
                }
            });

            // Save row functionality
            document.getElementById('saverow').addEventListener('click', function () {

                const data = grid.getData();
                // Filter out rows without a Key value
                const validData = data.filter(row => row.Key && row.Key.trim() !== '');

                // if (validData.length < data.length) {
                //     showToast('Key 값이 없는 항목은 저장되지 않았습니다.', 'warning');
                // }

                // Save only rows with valid Key values
                saveData(validData);

                showToast('데이터가 저장되었습니다.', 'success');
                updateDataCount();
            });

            // Add new row functionality
            document.getElementById('newrow').addEventListener('click', function () {
                const data = grid.getData();
                const hasEmptyRow = data.some(row => row.tpCd === '' || row.tpNm === '');
                if (hasEmptyRow) {
                    showToast('1번행에 입력가능 합니다.', 'info');
                    return;
                }



                const newRow = { Key: generateUUID(), tpCd: '', tpNm: '', descCntn: '', useYn: 'Y' };
                grid.prependRow(newRow, { focus: true });

                // grid.sort(null);
                // // Clear filtering
                // const filters = grid.getFilterState();
                // if (filters) {
                //     grid.clearAllFilters();
                // }
                // // Reset pagination to page 1
                // grid.pagination.movePageTo(1);

                saveData([...data, newRow]);
                updateDataCount();
            });

            grid.on('click', (ev) => {
                const { columnName } = ev;
                console.log(columnName);

                if (ev.columnName === 'Key') {
                    showToast('자동 부여 Key 로 편집 불가 합니다.', 'info');
                }

                if (ev.columnName === 'view') {
                    const row = grid.getRow(ev.Key);
                    toggleModal(true, `Row Data: ${JSON.stringify(row)}`);
                }
            });




            // Initialize a new row
            function initNew() {
                const rowData = { Key: generateUUID(), tpCd: '', tpNm: '', descCntn: '', useYn: 'Y' };
                grid.prependRow(rowData, { focus: true });
                updateDataCount();
            }

            initNew();

            // Close modal
            document.getElementById('closeModal').addEventListener('click', () => {
                toggleModal(false);
            });
        });

    </script>
</body>

</html>