<!DOCTYPE html>
<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css" />
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">


    <script type="text/javascript" src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"></script>
    <script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.js"></script>
    <script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>

    <style>
        .tui-grid-header-area {
            background-color: #4f7dd8 !important;
            color: #f5f6f8 !important;
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui,
                Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic",
                "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif !important;
        }

        .tui-grid-cell {
            /* background-color: transparent !important; */
            font-size: 16px !important;

            color: #333 !important;
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui,
                Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic",
                "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif !important;

        }

        /* Remove default yellow/pink backgrounds in TUI Grid */
        .tui-grid-cell.tui-grid-cell-has-focus {
            background-color: transparent !important;
            border-color: #3182ce !important;
        }

        .tui-grid-cell.tui-grid-cell-invalid {
            background-color: transparent !important;
        }


        .tui-grid-cell.tui-grid-cell-has-focus .tui-grid-cell-content {
            color: #bf4005 !important;

        }



        .tui-grid-check-input {
            width: 18px !important;
            height: 18px !important;
        }

        input[type="checkbox"] {
            width: 18px !important;
            height: 18px !important;
        }

        .tui-grid-row {
            border-bottom: 1px solid #cccccc !important;
        }

        .tui-grid-row:hover {
            background-color: #f0f8ff !important;
            border-bottom-color: #007aff !important;
        }

        .tui-grid-cell.tui-grid-cell-row-header {
            background-color: #a6b0c4 !important;
            /* Dark blue background */
            color: #3b3b3f !important;
            /* White text color */
        }

        .tui-grid-cell.tui-grid-cell-header {
            background-color: #a6b0c4 !important;
            /* Dark blue background */
            color: #3b3b3f !important;
            /* White text color */
            border-bottom: 1px solid #3b3b3f !important;
            /* Optional: Border color */
        }
    </style>




    <style>
        .toast {
            position: fixed;
            top: 1rem;
            /* Move to the top of the screen */
            right: 1rem;
            /* Align to the right */
            min-width: 200px;
            padding: 1rem;
            border-radius: 5px;
            font-size: 14px;
            color: #fff;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            /* Adjust animation direction for top placement */
            transition: opacity 0.3s, transform 0.3s;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-success {
            background-color: #38a169;
        }

        .toast-warning {
            background-color: #dd6b20;
        }

        .toast-info {
            background-color: #3182ce;
        }

        .toast-error {
            background-color: #e53e3e;
        }
    </style>

    <style>
        #modal>div {
            width: 90%;
            height: 90%;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            overflow: auto;
        }

        #modal h2 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        #modal p {
            flex-grow: 1;
            overflow: auto;
        }

        #modal button {
            align-self: flex-end;
        }
    </style>
    <style>
        #offCanvas {
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        }

        #hamburgerButton {
            margin-right: 1rem;
            /* Optional: Adjust spacing between the button and title */
        }

        #floatingNav button {
            transition: transform 0.2s ease;
        }

        #floatingNav button:hover {
            transform: scale(1.05);
        }

        #content {
            padding-left: 40px;
            padding-right: 15px;
            padding-top: 15px;
            padding-bottom: 15px;
            box-sizing: border-box;
            /* Ensures padding is included in the element's width */
        }
    </style>



</head>

<body class="bg-gray-200">
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <div id="offCanvas"
        class="fixed top-0 left-0 h-full w-64 bg-gray-800 text-white hidden transform -translate-x-full transition-transform duration-300 z-50">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-4">
                <h3 class="text-lg font-semibold">Menu</h3>
                <button id="closeOffCanvas" class="text-white text-xl"><i class="fas fa-chevron-left"></i></button>
            </div>
            <ul class="flex-grow p-4 space-y-2">
                <li><a href="#" class="block text-gray-200 hover:text-white">Home</a></li>
                <li><a href="#" class="block text-gray-200 hover:text-white">About</a></li>
                <li><a href="#" class="block text-gray-200 hover:text-white">Services</a></li>
                <li><a href="#" class="block text-gray-200 hover:text-white">Contact</a></li>
            </ul>
            <div class="p-4">
                <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">Logout</button>
            </div>
        </div>
    </div>



    <!-- content -->

    <div class="relative">
        <!-- Hamburger Button -->
        <button id="hamburgerButton" class="absolute top-0 left-0 text-gray-600 hover:text-gray-800 text-2xl p-2">
            <i class="fas fa-bars"></i>
        </button>


        <div id="content" class="w-full mx-auto p-2">
            <div class="bg-white shadow rounded-lg p-2">
                <div class="flex items-center mb-4">
                    <h2 class="text-lg font-semibold">에듀엠지티 기본 Grid Sample</h2>
                </div>

                <div>
                    <!-- Data count positioned above the grid on the left -->
                    <div class="flex justify-between items-center p-2">
                        <div id="dataCount" class="text-lg text-gray-700"></div>
                        <div class="flex justify-end mt-4 space-x-2">
                            <button id="newrow"
                                class="flex items-center space-x-2 px-4 py-1.5 text-white font-medium rounded bg-gray-800 hover:bg-gray-700">
                                <i class="fas fa-plus"></i>
                                <span>신규</span>
                            </button>
                            <button id="delrow"
                                class="flex items-center space-x-2 px-4 py-1.5 text-white font-medium rounded bg-gray-800 hover:bg-gray-700">
                                <i class="fas fa-trash"></i>
                                <span>삭제</span>
                            </button>
                            <button id="saverow"
                                class="flex items-center space-x-2 px-4 py-1.5 text-white font-medium rounded bg-gray-800 hover:bg-gray-700">
                                <i class="fas fa-save"></i>
                                <span>저장</span>
                            </button>
                        </div>


                    </div>
                    <!-- The grid -->
                    <div id="grid" class="mx-auto" style="width: 100%; height: 80vh;"></div>
                </div>

            </div>
        </div>

        <!-- Gear Icon -->
        <button id="gearIcon" class="fixed bottom-4 right-4 bg-gray-800 text-white rounded-full p-3 shadow-lg z-50">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Floating Navigation Menu -->
        <div id="floatingNav"
            class="fixed bottom-4 right-4 bg-gray-800 text-white rounded-lg shadow-lg p-4 z-50 hidden space-y-2">
            <div class="flex justify-between items-center">
                <h3 class="text-white font-semibold">Menu</h3>
                <button id="closeFloatingNav" class="text-white text-lg">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <button
                class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded flex items-center justify-center space-x-2">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button
                class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded flex items-center justify-center space-x-2">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
            </button>
            <button
                class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded flex items-center justify-center space-x-2">
                <i class="fas fa-cogs"></i>
                <span>Settings</span>
            </button>
        </div>

    </div>




    <div id="modal"
        class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-6 w-1/3 relative">
            <!-- Close button in the top-right corner -->
            <button id="closeModalTopRight" class="absolute top-2 right-2 text-gray-600 hover:text-gray-800 text-lg">
                &times;
            </button>
            <h2 class="text-lg font-semibold mb-4">Edit Row Details</h2>
            <form id="modalForm" class="space-y-4">
                <!-- Form elements will be dynamically inserted here -->
            </form>
            <div class="flex justify-end space-x-2 mt-4">
                <button id="saveModal" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Save</button>
                <button id="closeModal"
                    class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700">Close</button>
            </div>
        </div>
    </div>
    <!-- //content -->

    <script>


        document.addEventListener('DOMContentLoaded', function () {

            document.getElementById('gearIcon').addEventListener('click', () => {
                const floatingNav = document.getElementById('floatingNav');
                floatingNav.classList.remove('hidden'); // Show the floating menu
            });

            document.getElementById('closeFloatingNav').addEventListener('click', () => {
                const floatingNav = document.getElementById('floatingNav');
                floatingNav.classList.add('hidden'); // Hide the floating menu
            });


            document.getElementById('hamburgerButton').addEventListener('click', () => {
                const offCanvas = document.getElementById('offCanvas');
                offCanvas.classList.remove('hidden', '-translate-x-full'); // Show the off-canvas menu
            });

            document.getElementById('closeOffCanvas').addEventListener('click', () => {
                const offCanvas = document.getElementById('offCanvas');
                offCanvas.classList.add('-translate-x-full'); // Hide the off-canvas menu
            });


            // UUID Generator Function
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    const r = (Math.random() * 16) | 0,
                        v = c === 'x' ? r : (r & 0x3) | 0x8;
                    return v.toString(16);
                });
            }

            let rowsPerPage = 20; // Default rows per page

            // Function to update pagination
            function updatePagination(totalItems, perPage) {
                pagination.reset(totalItems); // Reset pagination with the updated total items
                pagination.setItemsPerPage(perPage); // Set items per page
            }

            // Function to load paginated data
            function loadPageData(page, perPage) {
                const allData = loadData();
                const start = (page - 1) * perPage;
                const end = start + perPage;
                return allData.slice(start, end);
            }

            // Function to update the total count display
            function updateDataCount() {
                const allData = loadData();
                const dataCountElement = document.getElementById('dataCount');
                dataCountElement.textContent = `Total Rows: ${allData.length}`;
            }

            // Function to load data from localStorage
            function loadData() {
                const data = localStorage.getItem('gridData');
                return data ? JSON.parse(data) : [];
            }

            // Function to save data to localStorage
            function saveData(data) {
                const filteredData = data.filter(row => row.tpCd && row.tpNm);
                localStorage.setItem('gridData', JSON.stringify(filteredData));
            }

            class BadgeRenderer {
                constructor(props) {
                    const el = document.createElement('span');
                    el.className = 'px-3 py-1 text-sm font-medium text-white bg-blue-500 rounded cursor-pointer hover:bg-blue-600';
                    el.textContent = 'View';
                    el.style.display = 'inline-block';
                    el.style.textAlign = 'center';
                    this.el = el;
                    this.props = props;
                }

                getElement() {
                    return this.el;
                }

                render(props) {
                    this.props = props;
                    // You can add any additional data binding logic here if needed
                }
            }


            // Initialize the grid
            const grid = new tui.Grid({
                el: document.getElementById('grid'),
                rowHeaders: ['rowNum', 'checkbox'],
                editingEvent: 'click',
                scrollX: true,
                scrollY: true,
                bodyHeight: 630,
                pageOptions: {
                    useClient: true,
                    perPage: rowsPerPage
                },
                rowHeight: 45,
                minRowHeight: 45,
                columns: [
                    { header: 'Key', name: 'Key', width: 250, align: 'left', sortable: true, resizable: true, width: 100, minWidth: 80 }, // UUID column    
                    { header: '그룹코드', name: 'tpCd', editor: 'text', validation: { required: true }, sortable: true, filter: 'text', resizable: true, width: 150 },
                    { header: '코드명', name: 'tpNm', editor: 'text', sortable: true, filter: 'text', resizable: true, width: 200 },
                    { header: '설명', name: 'descCntn', editor: 'text', sortable: true, filter: 'text', resizable: true, },
                    {
                        header: '사용여부', name: 'useYn', width: 100, align: 'center',
                        editor: {
                            type: 'select',
                            options: { listItems: [{ text: 'Y', value: 'Y' }, { text: 'N', value: 'N' }] }
                        },
                        sortable: true,
                        filter: {
                            type: 'select',
                            options: [
                                { text: 'All', value: '' },
                                { text: 'Y', value: 'Y' },
                                { text: 'N', value: 'N' }
                            ]
                        }
                    },
                    { header: '생성일시', name: 'createdAt', width: 200, align: 'center', sortable: true },
                    {
                        header: 'View',
                        name: 'view',
                        align: 'center',
                        text: 'V',
                        renderer: {
                            type: BadgeRenderer // Use the custom renderer for the badge
                        },
                        width: 60,
                        resizable: false
                    }
                ],
                data: loadPageData(1, rowsPerPage), // Load initial page data
                columnOptions: {
                    frozenCount: 2, // Freeze 3 left most columns and 
                    frozenBorderWidth: 2 // set the border width of frozen columns to be 2px.
                }
            });



            tui.Grid.applyTheme('striped', {
                cell: {
                    normal: {
                        border: '#cccccc' // Set row border color
                    },
                    evenRow: {
                        background: '#f9f9f9' // Optional: Add background for even rows
                    },
                    hover: {
                        border: '#007aff', // Optional: Border color on hover
                        background: '#f0f8ff' // Optional: Background color on hover
                    },
                    head: {
                        background: '#004080', // Set header background color (dark blue)
                        border: '#cccccc', // Set header border color
                        text: '#ffffff' // Set header text color (white)
                    }
                },
                rowHeader: {
                    background: '#002855', // Dark blue background
                    border: '#cccccc', // Optional: Row header border color
                    text: '#ffffff' // Optional: White text color
                }
            });


            // Initial update of data count
            updateDataCount();

            // Delete row functionality
            document.getElementById('delrow').addEventListener('click', function () {
                const chkArray = grid.getCheckedRowKeys();
                if (chkArray.length > 0) {
                    grid.removeCheckedRows();
                    saveData(grid.getData());
                    showToast('선택된 항목이 삭제되었습니다.', 'success');
                    updateDataCount();
                    //updatePagination(loadData().length, rowsPerPage);
                } else {
                    showToast('삭제할 항목이 선택되지 않았습니다.', 'warning');
                }
            });

            // Save row functionality
            document.getElementById('saverow').addEventListener('click', function () {

                const data = grid.getData();
                // Filter out rows without a Key value
                const validData = data.filter(row => row.Key && row.Key.trim() !== '');

                // if (validData.length < data.length) {
                //     showToast('Key 값이 없는 항목은 저장되지 않았습니다.', 'warning');
                // }

                // Save only rows with valid Key values
                saveData(validData);

                showToast('데이터가 저장되었습니다.', 'success');
                updateDataCount();
            });

            // Add new row functionality
            document.getElementById('newrow').addEventListener('click', function () {
                const data = grid.getData();
                const hasEmptyRow = data.some(row => row.tpCd === '' || row.tpNm === '');
                if (hasEmptyRow) {
                    showToast('1번행에 입력가능 합니다.', 'info');
                    return;
                }

                const newRow = {
                    Key: generateUUID(), tpCd: '', tpNm: '', descCntn: '', useYn: 'Y',
                    createdAt: new Date().toLocaleString()
                };
                grid.prependRow(newRow, { focus: true });

                saveData([...data, newRow]);
                updateDataCount();
            });

            // Handle View Button Click in Grid
            grid.on('click', (ev) => {
                const { columnName, rowKey } = ev;

                console.log("rowKey : " + rowKey);

                if (columnName === 'view') {
                    const row = grid.getRow(rowKey); // Get the row data
                    toggleModal(true, row, rowKey); // Pass the row data and row key to the modal
                }

                if (ev.columnName === 'Key') {
                    showToast('자동 부여 Key 로 편집 불가 합니다.', 'info');
                }
            });


            // Initialize a new row
            function initNew() {
                const rowData = { Key: generateUUID(), tpCd: '', tpNm: '', descCntn: '', useYn: 'Y', createdAt: new Date().toLocaleString() };
                grid.prependRow(rowData, { focus: true });
                updateDataCount();
            }

            initNew();

            // Close modal
            document.getElementById('closeModal').addEventListener('click', () => {
                toggleModal(false);
            });


            let currentRowKey = null; // To track the current row being edited

            function toggleModal(show, rowData = {}, rowKey = null) {
                const modal = document.getElementById('modal');
                const modalForm = document.getElementById('modalForm');
                currentRowKey = rowKey; // Store the row key

                if (show) {
                    // Clear the form
                    modalForm.innerHTML = '';

                    // Populate the form with row data
                    for (const [key, value] of Object.entries(rowData)) {
                        const formGroup = document.createElement('div');
                        formGroup.className = 'flex flex-col';

                        const label = document.createElement('label');
                        label.className = 'text-sm font-medium text-gray-700';
                        label.textContent = key;

                        const input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'border rounded px-3 py-2 mt-1 text-gray-900';
                        input.name = key;
                        input.value = value;

                        formGroup.appendChild(label);
                        formGroup.appendChild(input);
                        modalForm.appendChild(formGroup);
                    }

                    modal.classList.remove('hidden'); // Show modal
                } else {
                    modal.classList.add('hidden'); // Hide modal
                }
            }

            document.getElementById('saveModal').addEventListener('click', () => {
                const modalForm = document.getElementById('modalForm');
                const formData = new FormData(modalForm);
                const updatedData = {};

                // Collect updated values from the form
                for (const [key, value] of formData.entries()) {
                    updatedData[key] = value;
                }

                if (currentRowKey !== null) {
                    // Update the grid's data
                    //grid.setValue(currentRowKey, 'Key', updatedData.Key);
                    grid.setValue(currentRowKey, 'tpCd', updatedData.tpCd);
                    grid.setValue(currentRowKey, 'tpNm', updatedData.tpNm);
                    grid.setValue(currentRowKey, 'descCntn', updatedData.descCntn);
                    grid.setValue(currentRowKey, 'useYn', updatedData.useYn);
                }

                // Hide the modal and show a success toast
                toggleModal(false);
                saveData(grid.getData());
                showToast('해당 건의 데이타를 저장하였습니다.', 'success');
            });

            // Add event listener for the top-right close button
            document.getElementById('closeModalTopRight').addEventListener('click', () => {
                toggleModal(false);
            });

            // Add event listener for the bottom close button
            document.getElementById('closeModal').addEventListener('click', () => {
                toggleModal(false);
            });

            // Toast Functionality
            function showToast(message, type = 'success') {
                const toastContainer = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type} show`;
                toast.innerText = message;

                toastContainer.appendChild(toast);

                // Automatically remove the toast after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

        });

    </script>
</body>

</html>